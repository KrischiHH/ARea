<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"/>
  <title>WebAR â€“ Image (A-Frame + MindAR)</title>
  <style> html,body{margin:0;height:100%;background:#000} #ui{position:fixed;left:50%;bottom:20px;transform:translateX(-50%);z-index:9} button{padding:10px 14px;border-radius:12px;border:1px solid #333;background:#111;color:#fff} </style>
  <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
  <script src="https://unpkg.com/mind-ar@1.1.5/dist/mindar-image-aframe.prod.js"></script>
</head>
<body>
<div id="ui"><button onclick="start()">ðŸš€ AR starten</button></div>
<script>
function patchNextGUM(deviceId){
  const orig=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices); let used=false;
  navigator.mediaDevices.getUserMedia=(c)=>{ if(!used){ const v=c?.video===true?{}:(c?.video||{}); c={...c,video:{...v,deviceId:{exact:deviceId}}}; used=true; } const p=orig(c); p.finally(()=>{ navigator.mediaDevices.getUserMedia=orig; }); return p; };
}
async function start(){
  const pref=localStorage.getItem('webar.cameraId'); if(pref) patchNextGUM(pref);
  const marker = "https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/examples/image-tracking/assets/card-example/card.mind";
  const s=document.createElement('a-scene');
  s.setAttribute('mindar-image', `imageTargetSrc: ${marker}`);
  s.setAttribute('embedded',''); s.setAttribute('vr-mode-ui','enabled: false'); s.setAttribute('device-orientation-permission-ui','enabled: false');
  const cam=document.createElement('a-camera'); cam.setAttribute('position', '0 0 0'); s.appendChild(cam);
  const anchor=document.createElement('a-entity'); anchor.setAttribute('mindar-image-target','targetIndex: 0');
  const box=document.createElement('a-box'); box.setAttribute('position','0 0 0.1'); box.setAttribute('depth','0.2'); box.setAttribute('height','0.2'); box.setAttribute('width','0.2'); box.setAttribute('color','#4af');
  anchor.appendChild(box); s.appendChild(anchor);
  document.body.appendChild(s);
}
</script>
</body>
</html>
