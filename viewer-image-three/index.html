<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"/>
  <title>WebAR – Image (MindAR + Three)</title>
  <style>
    :root{color-scheme:dark}
    html,body{margin:0;height:100%;background:#000;overflow:hidden;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
    #ui{position:fixed;left:50%;bottom:80px;transform:translateX(-50%);z-index:3}
    #start{background:#111;border:1px solid #333;color:#fff;padding:10px 14px;border-radius:12px}
    #log{position:fixed;right:10px;bottom:10px;max-width:70vw;background:rgba(0,0,0,.6);color:#fff;
         padding:8px 10px;border-radius:10px;font:12px/1.3 system-ui;white-space:pre-wrap;z-index:3}
    #target{position:fixed;right:10px;top:10px;z-index:3;background:#111;border:1px solid #222;border-radius:10px;padding:6px}
  </style>
</head>
<body>
  <div id="ui"><button id="start">🚀 AR starten</button></div>
  <div id="log"></div>
  <div id="target">
    <div style="color:#bbb;font:12px/1.2 system-ui;margin-bottom:4px">Target Preview:</div>
    <img src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/examples/image-tracking/assets/card-example/card.png" width="120" height="66"/>
  </div>

  <script type="module">
    import * as THREE from "https://unpkg.com/three@0.160.0/build/three.module.js";
    import { GLTFLoader } from "https://unpkg.com/three@0.160.0/examples/jsm/loaders/GLTFLoader.js";
    import { MindARThree } from "https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-three.prod.js";

    const log = (m)=>{ const el=document.getElementById('log'); el.textContent += (el.textContent?'\n':'') + m; };

    let started = false;
    document.getElementById('start').onclick = async ()=>{
      if(started) return; started = true;
      document.getElementById('start').style.display='none';

      const mindarThree = new MindARThree({
        container: document.body,
        imageTargetSrc: "https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/examples/image-tracking/assets/card-example/card.mind",
        uiLoading: true,
        uiError: true,
        maxTrack: 1,
        warmupTolerance: 5,
      });
      const {renderer, scene, camera} = mindarThree;

      // Renderer konservativ einstellen (Samsung/lowp)
      renderer.outputColorSpace = THREE.SRGBColorSpace;
      renderer.setPixelRatio(Math.min(devicePixelRatio, 2));

      // Licht & einfache Szene
      scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 1.0));

      const anchor = mindarThree.addAnchor(0);
      const loader = new GLTFLoader();
      loader.load(
        "https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/examples/image-tracking/assets/card-example/softmind/scene.gltf",
        (gltf)=>{
          const model = gltf.scene;
          model.scale.set(0.005,0.005,0.005);
          model.position.set(0,0,0.1);
          anchor.group.add(model);
        },
        undefined,
        (err)=> log("❌ GLTF-Fehler: "+err.message)
      );

      // Debug: Video-Info
      const v = mindarThree.video;
      const iv = setInterval(()=>{ if(v.videoWidth) { log(`📹 Video ${v.videoWidth}x${v.videoHeight}`); clearInterval(iv);} }, 300);

      await mindarThree.start(); // startet Kamera + Tracking
      log("✅ MindAR gestartet");
      renderer.setAnimationLoop(()=>{ renderer.render(scene, camera); });
    };
  </script>
</body>
</html>
