<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Image AR – MindAR + Three (import map)</title>
<style>
  html,body{margin:0;height:100%;overflow:hidden;background:#000;color:#fff;font-family:system-ui}
  #ui{position:fixed;inset:auto 0 0 0;display:flex;gap:8px;justify-content:flex-end;padding:12px;z-index:20}
  #log{position:fixed;left:12px;top:12px;z-index:20;background:rgba(0,0,0,.55);padding:8px 10px;border-radius:8px;font:12px/1.3 monospace}
  #hint{position:fixed;right:12px;top:12px;z-index:10;pointer-events:none}
  #hint img{width:160px;border-radius:10px;opacity:.9}
  button{padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.25);background:#111;color:#fff}
</style>

<!-- Polyfill SYNCHRON laden, dann Import-Map -->
<script src="https://unpkg.com/es-module-shims@1.10.0/dist/es-module-shims.js" crossorigin="anonymous"></script>
<script type="importmap">
{
  "imports": {
    "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
    "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/",
    "mindar-image-three": "https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-three.prod.js"
  }
}
</script>
</head>
<body>
<div id="log">Bereit…</div>
<div id="ui">
  <button id="start">Start AR</button>
  <button id="switch" disabled>Kamera wechseln</button>
</div>
<div id="hint">
  <!-- Ersetze das Bild bei Bedarf durch ../targets/target.png -->
  <img src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/examples/image-tracking/assets/card-example/card.png" alt="Referenzbild">
</div>

<script type="module">
  import * as THREE from 'three';
  import { MindARThree } from 'mindar-image-three';

  const log = (t)=>{ document.getElementById('log').textContent=t; console.log(t); };

  // ===== Target wählen =====
  const IMAGE_TARGET = 
    'https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/examples/image-tracking/assets/card-example/card.mind';
    // Für DEIN Target umstellen auf:
    // '../assets/targets/target.mind?v=7';

  // MindAR initialisieren
  const mindarThree = new MindARThree({
    container: document.body,
    imageTargetSrc: IMAGE_TARGET
  });

  const { renderer, scene, camera } = mindarThree;
  renderer.setSize(innerWidth, innerHeight);
  renderer.setPixelRatio(devicePixelRatio);
  renderer.outputColorSpace = THREE.SRGBColorSpace;
  renderer.setClearColor(0x000000, 0);

  // Licht
  scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 1.2));
  const dir = new THREE.DirectionalLight(0xffffff, 1.0); dir.position.set(0,6,0); scene.add(dir);

  // Anchor + Demo-Objekt
  const anchor = mindarThree.addAnchor(0);
  const cube = new THREE.Mesh(new THREE.BoxGeometry(0.5,0.5,0.5), new THREE.MeshNormalMaterial());
  anchor.group.add(cube);
  anchor.onTargetFound = ()=>{ document.getElementById('hint').style.display='none'; log('targetFound'); };
  anchor.onTargetLost  = ()=>{ document.getElementById('hint').style.display='block'; log('targetLost'); };

  // Start + Kamera wechseln
  const startBtn = document.getElementById('start');
  const switchBtn = document.getElementById('switch');

  startBtn.addEventListener('click', async ()=>{
    try{
      startBtn.disabled = true;
      await mindarThree.start();
      switchBtn.disabled = false;
      renderer.setAnimationLoop(()=>renderer.render(scene, camera));
      log('AR gestartet');
    }catch(e){
      log('Start-Fehler: ' + e);
      alert('Start fehlgeschlagen: ' + e);
      startBtn.disabled = false;
    }
  });

  switchBtn.addEventListener('click', async ()=>{
    try{ await mindarThree.switchCamera(); log('Kamera gewechselt'); }
    catch(e){ log('switchCamera error: ' + e); }
  });

  addEventListener('resize', ()=>renderer.setSize(innerWidth, innerHeight));

  // Falls irgendwo ein Fehler hochkommt, landet er im Log:
  window.onerror = (m,s,l,c,e)=>{ log('JS-Fehler: ' + m); };
</script>
</body>
</html>
