<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Image AR – MindAR + Three (no import map)</title>
<style>
  html,body{margin:0;height:100%;overflow:hidden;background:#000;color:#fff;font-family:system-ui}
  #ui{position:fixed;inset:auto 0 0 0;display:flex;gap:8px;justify-content:flex-end;padding:12px;z-index:20}
  #log{position:fixed;left:12px;top:12px;z-index:20;background:rgba(0,0,0,.55);padding:8px 10px;border-radius:8px;max-width:80vw;font:12px/1.3 monospace;white-space:pre-wrap}
  #hint{position:fixed;right:12px;top:12px;z-index:10;pointer-events:none}
  #hint img{width:160px;height:auto;opacity:.9;border-radius:10px;display:block}
  button{padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.25);background:#111;color:#fff}
</style>
</head>
<body>
<div id="log">Bereit…</div>
<div id="ui">
  <button id="start">Start AR</button>
  <button id="switch" disabled>Kamera wechseln</button>
</div>
<!-- kleines, nicht-blockierendes Vorschau-Overlay -->
<div id="hint"><img
  src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/examples/image-tracking/assets/card-example/card.png"
  alt="Referenzbild"></div>

<script>
  // Falls irgendein Fehler passiert, siehst du ihn oben links:
  window.onerror = (m,s,l,c,e)=>{document.getElementById('log').textContent = 'JS-Fehler: '+m;};
</script>

<script type="module">
  import * as THREE from 'https://unpkg.com/three@0.160.0/build/three.module.js';
  import { MindARThree } from 'https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-three.prod.js';

  const log = (t)=>{ const el=document.getElementById('log'); el.textContent=t; console.log(t); };

  // 1) ZUERST mit dem CDN-Target testen (Known-Good)
  const mindarThree = new MindARThree({
    container: document.body,
    imageTargetSrc: 'https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/examples/image-tracking/assets/card-example/card.mind'
    // → Wenn das läuft, danach auf DEIN Target umstellen:
    // imageTargetSrc: '../assets/targets/target.mind?v=6'
  });

  const { renderer, scene, camera } = mindarThree;
  renderer.setSize(innerWidth, innerHeight);
  renderer.setPixelRatio(devicePixelRatio);
  renderer.outputColorSpace = THREE.SRGBColorSpace;
  renderer.setClearColor(0x000000, 0);

  scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 1.2));
  const dir = new THREE.DirectionalLight(0xffffff, 1.0); dir.position.set(0,6,0); scene.add(dir);

  const anchor = mindarThree.addAnchor(0);
  const cube = new THREE.Mesh(new THREE.BoxGeometry(0.5,0.5,0.5), new THREE.MeshNormalMaterial());
  anchor.group.add(cube);
  anchor.onTargetFound = ()=>{ document.getElementById('hint').style.display='none'; log('targetFound'); };
  anchor.onTargetLost  = ()=>{ document.getElementById('hint').style.display='block'; log('targetLost'); };

  document.getElementById('start').addEventListener('click', async ()=>{
    try{
      document.getElementById('start').disabled = true;
      await mindarThree.start();
      document.getElementById('switch').disabled = false;
      renderer.setAnimationLoop(()=>renderer.render(scene,camera));
      log('AR gestartet');
    }catch(e){ log('Start-Fehler: '+e); alert('Start fehlgeschlagen: '+e); document.getElementById('start').disabled=false; }
  });

  document.getElementById('switch').addEventListener('click', async ()=>{
    try{ await mindarThree.switchCamera(); log('Kamera gewechselt'); }catch(e){ log('switchCamera error: '+e); }
  });

  addEventListener('resize', ()=>renderer.setSize(innerWidth,innerHeight));
</script>
</body>
</html>
